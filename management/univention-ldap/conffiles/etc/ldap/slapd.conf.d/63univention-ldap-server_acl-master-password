@!@
ldap_base = configRegistry['ldap/base']
priv = 'write' if configRegistry.get('ldap/server/type') == "master" else 'read'

password_attributes = 'krb5Key,userPassword,sambaPwdCanChange,sambaPwdMustChange,sambaLMPassword,sambaNTPassword,sambaPwdLastSet,pwhistory,sambaPasswordHistory,krb5KDCFlags,krb5KeyVersionNumber,krb5PasswordEnd,shadowMax,shadowLastChange'

INDENT = f'  %s'
TO_CLAUSE = f'access to\n%s' % INDENT
BY_CLAUSE = INDENT % f'by %s '

if configRegistry.is_true('ldap/acl/user/password/change'):
	print(TO_CLAUSE % f'attrs="{password_attributes}"')
	print(BY_CLAUSE % f'self {priv}')
	print(BY_CLAUSE % '* none break')
	print('')

print('# grant write access to users own UMC properties')
print(TO_CLAUSE % 'attrs="univentionUMCProperty"')
print(INDENT % 'filter="objectClass=person"')
print(BY_CLAUSE % f'self {priv}')
print(BY_CLAUSE % '* none break')

print(TO_CLAUSE % 'filter="objectClass=person"')
print(INDENT % 'attrs=objectClass')
print(INDENT % 'value=univentionPerson')
print(BY_CLAUSE % f'self {priv}')
print(BY_CLAUSE % '* none break')
print('')
@!@
